# Jupyter Notebook Viewer

## Overview
Это форк репозитория [jupyter-edx-viewer-xblock](https://github.com/iblai/jupyter-edx-viewer-xblock), адаптированный для работы в tutor. 
В файле `jupyter_viewer.yml` выполняется шаг `LMS/CMS Setup` из оригинального репозитория


## Installation
### XBlock
* Добавить в переменную окружения `OPENEDX_EXTRA_PIP_REQUIREMENTS` ссылку не репозиторий
```bash
tutor config save --append OPENEDX_EXTRA_PIP_REQUIREMENTS='git+https://github.com/Ezereul/jupyter-edx-viewer-xblock.git'
```
* Скопировать файл jupyter_viewer.yml в папку tutor-plugins
* Затем активировать плагин jupyter_viewer
```bash
tutor plugins enable jupyter_viewer
```
* Пересобрать образы и запустить платформу

### Добавление блока на платформе
1. Зайти в studio
2. Раскрыть `Настройки` в шапке страницы и выбрать `Расширенные настройки`
3. Найти `Advanced Module List`/`Список дополнительных модулей` и добавить туда `"xblock_jupyter_viewer"`
4. После этого блок `Jupyter Notebook Viewer` станет доступен во вкладке `Дополнительно` при редактировании курса

## Как это работает
XBlock содержит `iframe`, который указывает на REST-эндпоинт.

REST-эндпоинт принимает следующие параметры запроса:
* `url`: URL к **RAW** файлу Jupyter Notebook в формате JSON
* `start`: (необязательно) текст, который содержится в начальной ячейке
    * если указано, отображение начнется с **ПЕРВОЙ** ячейки, содержащей этот текст
    * если не указано, отображение начнется с начала документа
* `end`: (необязательно) текст, который содержится в конечной ячейке
    * если указано, отображение завершится на **ПЕРВОЙ** ячейке, содержащей этот текст (исключительно - эта ячейка не отображается)
    * если не указано, отображение завершится в конце документа
* `images_url`: (необязательно) URL к корневому каталогу для изображений (для тегов `<img>`)
    * если указано, этот URL будет добавлен в начало имени файла в атрибуте `src` всех тегов `<img src=...>` в ноутбуке
    * пример:
        * images_url: `http://mysite.com/images/`
        * `<img src="/something/image.jpg">` станет `<img src="http://mysite.com/images/image.jpg">`

Часто проще всего использовать заголовки Markdown в качестве начальных/конечных тегов, например:
* `### Мой стартовый заголовок`

Если начальные/конечные теги не найдены в документе, они игнорируются.

REST-эндпоинт возвращает весь HTML-код с встроенными CSS для отображения в iframe XBlock.

Пользователь также может задать высоту XBlock в пикселях в Studio.

## Пре/Пост-обработчики
Существует несколько пре- и пост-обработчиков, которые применяются к ноутбуку при его преобразовании в финальный HTML.

### Пре-обработчики
Они работают с каждой ячейкой ноутбука, обычно внося изменения либо в общую структуру ноутбука, либо в отдельную ячейку.

Ячейки ноутбука перебираются поочередно, и каждая ячейка передается каждому обработчику в порядке, в котором они добавлены.

После завершения обработки всех ячеек вызывается функция `finish` для каждого обработчика для выполнения любых заключительных операций.

Новые пре-обработчики можно добавить, создавая подклассы от `preprocessors.Processor` и добавляя экземпляр в список `transforms`.

### Пост-обработчики
Они работают с финальной, необработанной строкой HTML, внося необходимые изменения.

Новые пост-обработчики можно добавить в функцию `postprocess`.

## Примечания по использованию

### Посмотрите демо!

[![демо](https://github.com/ibleducation/jupyter-viewer-xblock/blob/master/demo-thumbnail.png)](http://www.youtube.com/watch?v=K8jhWgQnxvI)

### Функциональность

Jupyter Viewer XBlock позволяет автору курса добавить контент в онлайн-курс на платформе Open edX, используя общедоступный Jupyter Notebook (например, на GitHub).
Если вы предоставите только один параметр — публичный URL ноутбука, XBlock отобразит весь ноутбук в iframe.
Но часто преподаватели создают Jupyter Notebook с полным уроком, который может занимать несколько страниц при печати.
Отображение всего ноутбука в одном фрейме внутри онлайн-курса может ухудшить пользовательский опыт.
Наш опыт показывает, что ваш онлайн-курс будет выглядеть лучше, если вы разбьете урок на несколько единиц в последовательности обучения на Open edX.
Вы можете достичь этого, выбрав теги _start_ и _end_ — строки в исходном ноутбуке, которые отмечают первую и (исключительно) последнюю ячейки для отображения.
После выбора этих тегов вы можете настроить высоту iframe, чтобы она соответствовала длине контента.
Если у вас есть изображения, встроенные в ячейки с Markdown, скорее всего, у вас есть относительный путь, который работает в вашем локальном ноутбуке.
В XBlock вы можете указать абсолютный путь к изображениям в репозитории ноутбука, чтобы они корректно отображались.


